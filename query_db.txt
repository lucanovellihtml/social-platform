-- QUERY ESERCIZIO
SELECT * FROM USERS;
SELECT * FROM POSTS;
SELECT * FROM MEDIAS;
SELECT * FROM LIKES;


-- 1. SELEZIONARE GLI UTENTI CHE HANNO POSTATO ALMENO UN VIDEO
SELECT
	DISTINCT 
	USERS.USERNAME ,
	MEDIAS.`TYPE`
FROM
	USERS
INNER JOIN MEDIAS ON
	USERS.ID = MEDIAS.USER_ID
WHERE
	`TYPE` = 'VIDEO';


-- 2. SELEZIONARE TUTTI I POST SENZA LIKE
SELECT
	POSTS.TITLE,
	LIKES.USER_ID
FROM
	POSTS
LEFT JOIN LIKES ON
	POSTS.ID = LIKES.POST_ID
WHERE
	LIKES.USER_ID IS NULL;
	

-- 3. CONTA IL NUMERO DI LIKE PER OGNI POST
SELECT
	POSTS.TITLE,
	COUNT(LIKES.USER_ID) AS TOTAL_LIKES
FROM
	POSTS
INNER JOIN LIKES ON
	POSTS.ID = LIKES.POST_ID
GROUP BY
	LIKES.POST_ID;	


-- 4. ORDINA GLI UTENTI PER IL NUMERO DI MEDIA CARICATI
SELECT 
	USERS.USERNAME AS NAME_USER,
	COUNT(MEDIAS.ID) AS TOTAL_MEDIAS
FROM
	USERS
INNER JOIN MEDIAS ON
	USERS.ID = MEDIAS.USER_ID
GROUP BY
	MEDIAS.USER_ID
ORDER BY
	TOTAL_MEDIAS DESC;
	

-- 5. ORDINA GLI UTENTI PER TOTALE DI LIKES RICEVUTI NEL LORO POSTS
SELECT
	USERS.ID,
	USERS.USERNAME,
	COUNT(LIKES.USER_ID) AS LIKE_TOTAL
FROM
	USERS
INNER JOIN POSTS ON
	USERS.ID = POSTS.USER_ID
INNER JOIN LIKES ON
	POSTS.ID = LIKES.POST_ID
GROUP BY 
	USERS.ID
order by LIKE_TOTAL DESC;